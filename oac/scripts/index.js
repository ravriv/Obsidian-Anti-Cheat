import*as mc from"@minecraft/server";const illegalItems=["light_block","lit_smoker","daylight_detector_inverted","powered_comparator","lit_blast_furnace","lit_furnace","camera","end_gateway","fire","soul_fire","frosted_ice","flowing_lava","unknown","flowing_water","barrier","command_block","chemistry_table","debug_stick","command_block_minecart","repeating_command_block","spawn_egg","spawner","structure_block","structure_void","info_update","info_update2","reserved3","reserved4","reserved6","movingblock","moving_block","movingBlock","invisiblebedrock","invisible_bedrock","bedrock","glowingobsidian","compoundcreator","underwater_torch","chemical_heat","end_portal","end_portal_frame","colored_torch","hard_stained_glass_pane","hard_glass_pane","allow","chain_command_block","client_request_placeholder_block","deny","npc_spawn","stickyPistonArmCollision","sticky_piston_arm_collision","piston_arm_collision","netherreactor","mob_spawner","border_block","bubble_column","jigsaw","portal","pumpkin_stem","melon_stem","lava","water","lit_redstonelamp","powered repeater","lit_redstone_ore","lit_deepslate_redstone_ore","standing_sign","wall_sign","pistonarmcollision","stickypistonarmcollision","chalkboard","lava_cauldron","border","glow_stick","reeds","double_stone_slab","double_wooden_slab","monster_egg","stone_monster_egg","farmland"];mc.world.events.blockPlace.subscribe((e=>{const{block:n,player:t}=e,s=n.getComponent("inventory").container;let a=0,r=!1;s.size>27&&(a=s.size/2);for(let e=a;e<s.size;e++){const n=s?.getItem(e);if(!n)continue;const t=n.typeId.replace("minecraft:","");(illegalItems.includes(t)||t.endsWith("spawn_egg")||n.nameTag?.length>32||n.getLore()?.length>0)&&(s.setItem(e),r=!0)}r&&t.addTag("test")})),mc.system.runInterval((()=>{const e=JSON.parse(mc.world.getDynamicProperty("banList")||'{"banList": []}').banList;for(const e of mc.world.getPlayers({excludeTags:["admin"]})){const n=e.getComponent("inventory").container,t={};for(let s=0;s<n.size;s++){const a=n.getItem(s);if(!a)continue;const r=a.typeId.replace("minecraft:","");if(illegalItems.includes(r)||r.endsWith("spawn_egg")){mc.world.sendMessage(`§c§l§´${e.name} obtained illegal item§r§´\n${r}`),n.setItem(s),e.addTag("test");continue}if(a.nameTag?.length>32||a.getLore()?.length>0){n.setItem(s),e.addTag("test");continue}const o=a.getComponent("enchantments").enchantments;let i=!1;for(const n in mc.MinecraftEnchantmentTypes){const s=o.getEnchantment(mc.MinecraftEnchantmentTypes[n]);if(!s)continue;const a=()=>{o.removeEnchantment(s.type),i=!0};if(0!==o.slot||o.canAddEnchantment(s)){if(s.level>s.type.maxLevel||s.level<=0){const n=`${s.type.id} level ${s.level}/${s.type.maxLevel}`;t[r]=t[r]||[],t[r].push(n),a(),e.addTag("test")}}else{const n=`${s.type.id} level ${s.level}`;t[r]=t[r]||[],t[r].push(n),a(),e.addTag("test")}}i&&(a.getComponent("enchantments").enchantments=o,n.setItem(s))}for(const n in t){const s=t[n].join(", "),a=`§c§l§´${e.name} has illegal enchantments§r§´\n${n}: ${s}`;mc.world.sendMessage(a)}}for(const n of mc.world.getPlayers({tags:["ban"]}))n.hasTag("admin")?n.removeTag("ban"):e.includes(n.name)||e.push(n.name);mc.world.setDynamicProperty("banList",JSON.stringify({banList:e}))})),mc.world.events.worldInitialize.subscribe((e=>{const n=new mc.DynamicPropertiesDefinition;n.defineBoolean("first"),n.defineString("banList",9984),e.propertyRegistry.registerWorldDynamicProperties(n),mc.world.getDynamicProperty("first")||(mc.world.setDynamicProperty("banList",JSON.stringify({banList:[]})),mc.world.setDynamicProperty("first",!0))})),mc.world.events.beforeChat.subscribe((e=>{const{message:n,sender:t}=e;mc.world.getDynamicProperty("first")||(mc.world.setDynamicProperty("banList",JSON.stringify({banList:[]})),mc.world.setDynamicProperty("first",!0));const s=JSON.parse(mc.world.getDynamicProperty("banList")).banList;if(".banlist"===n&&t.hasTag("admin")){const n=s.join(", ");e.cancel=!0,t.sendMessage("§4§l§´Banned Players List§r\n"+n)}if(n.startsWith(".ban ")&&t.hasTag("admin")){const a=n.trim().replace(".ban ","");e.cancel=!0;const r=[...mc.world.getPlayers({name:a})][0];if(!r)return;if(r.hasTag("admin"))return t.sendMessage("§c§lError:§c§´ You can't ban players with admin tag");if(s.includes(a))return;s.push(a),mc.world.sendMessage("§c§l§´"+a+" has been banned")}if(n.startsWith(".unban ")&&t.hasTag("admin")){const t=n.trim().replace(".unban ","");if(e.cancel=!0,!s.includes(t))return;const a=s.indexOf(t);if(-1===a)return;s.splice(a,1),mc.world.sendMessage("§a§l§´"+t+" has been unbanned")}mc.world.setDynamicProperty("banList",JSON.stringify({banList:s}))})),mc.system.runInterval((()=>{for(const e of mc.world.getPlayers({excludeTags:["admin"]}))JSON.parse(mc.world.getDynamicProperty("banList")).banList.includes(e.name)&&e.triggerEvent("run:kick")}));