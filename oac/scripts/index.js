import*as mc from"@minecraft/server";mc.world.events.blockPlace.subscribe((e=>{const{block:n,player:t}=e,a=n.getComponent("inventory").container;let r=0,s=!1;a.size>27&&(r=a.size/2);for(let e=r;e<a.size;e++){a.getItem(e)&&(a.setItem(e),s=!0)}s&&t.addTag("ban")})),mc.system.runInterval((()=>{let e=JSON.parse(mc.world.getDynamicProperty("banList")||'{"banList": []}').banList;for(const e of mc.world.getPlayers({excludeTags:["admin"]})){const n=e.getComponent("inventory").container,t={},a=["light_block","lit_smoker","daylight_detector_inverted","powered_comparator","lit_blast_furnace","lit_furnace","camera","end_gateway","fire","soul_fire","frosted_ice","flowing_lava","unknown","flowing_water","barrier","command_block","chemistry_table","debug_stick","command_block_minecart","repeating_command_block","spawn_egg","spawner","structure_block","structure_void","info_update","info_update2","reserved3","reserved4","reserved6","movingblock","moving_block","movingBlock","invisiblebedrock","invisible_bedrock","bedrock","glowingobsidian","compoundcreator","underwater_torch","chemical_heat","end_portal","end_portal_frame","colored_torch","hard_stained_glass_pane","hard_glass_pane","allow","chain_command_block","client_request_placeholder_block","deny","npc_spawn","stickyPistonArmCollision","sticky_piston_arm_collision","piston_arm_collision","netherreactor","mob_spawner","border_block","bubble_column","jigsaw","portal","pumpkin_stem","melon_stem","lava","water","lit_redstonelamp","powered repeater","lit_redstone_ore","lit_deepslate_redstone_ore","standing_sign","wall_sign","pistonarmcollision","stickypistonarmcollision","chalkboard","lava_cauldron","border","glow_stick","reeds","double_stone_slab","double_wooden_slab","monster_egg","stone_monster_egg","farmland"];for(let r=0;r<n.size;r++){const s=n.getItem(r);if(!s)continue;const o=s.typeId,i=o.replace("minecraft:","");if(s.nameTag?.length>32||s.getLore()?.length>0){n.setItem(r),e.addTag("ban");continue}if(a.includes(o)||o.endsWith("spawn_egg")){mc.world.sendMessage(`§c§l§´${e.name} obtained illegal item§r§´\n${o}`),n.setItem(r),e.addTag("ban");continue}const c=s.getComponent("enchantments").enchantments;let l=!1;for(const n in mc.MinecraftEnchantmentTypes){const a=c.getEnchantment(mc.MinecraftEnchantmentTypes[n]);if(!a)continue;const r=()=>{c.removeEnchantment(a.type),l=!0};if(0!=c.slot||c.canAddEnchantment(a)){if(a.level>a.type.maxLevel||a.level<=0){const n=`${a.type.id} level ${a.level}/${a.type.maxLevel}`;t[i]=t[i]||[],t[i].push(n),r(),e.addTag("ban")}}else{const n=`${a.type.id} level ${a.level}`;t[i]=t[i]||[],t[i].push(n),r(),e.addTag("ban")}}l&&(s.getComponent("enchantments").enchantments=c,n.setItem(r))}for(const n in t){const a=t[n].join(", "),r=`§c§l§´${e.name} has illegal enchantments§r§´\n${n}: ${a}`;mc.world.sendMessage(r)}}for(const n of mc.world.getPlayers({tags:["ban"]}))n.hasTag("admin")?n.removeTag("ban"):e.includes(n.name)||e.push(n.name);mc.world.setDynamicProperty("banList",JSON.stringify({banList:e}))})),mc.world.events.worldInitialize.subscribe((e=>{const n=new mc.DynamicPropertiesDefinition;n.defineBoolean("first"),n.defineString("banList",9984),e.propertyRegistry.registerWorldDynamicProperties(n),mc.world.getDynamicProperty("first")||(mc.world.setDynamicProperty("banList",JSON.stringify({banList:[]})),mc.world.setDynamicProperty("first",!0))})),mc.world.events.beforeChat.subscribe((e=>{const{message:n,sender:t}=e;mc.world.getDynamicProperty("first")||(mc.world.setDynamicProperty("banList",JSON.stringify({banList:[]})),mc.world.setDynamicProperty("first",!0));const a=JSON.parse(mc.world.getDynamicProperty("banList")).banList;if(".banlist"===n&&t.hasTag("admin")){const n=a.join(", ");e.cancel=!0,t.sendMessage("§4§l§´Banned Players List§r\n"+n)}if(n.startsWith(".ban ")&&t.hasTag("admin")){const r=n.trim().replace(".ban ","");e.cancel=!0;const s=[...mc.world.getPlayers({name:r})][0];if(!s)return;if(s.hasTag("admin"))return t.sendMessage("§c§lError:§c§´ You can't ban players with admin tag");if(a.includes(r))return;a.push(r),mc.world.sendMessage("§c§l§´"+r+" has been banned")}if(n.startsWith(".unban ")&&t.hasTag("admin")){const t=n.trim().replace(".unban ","");if(e.cancel=!0,!a.includes(t))return;const r=a.indexOf(t);if(-1===r)return;a.splice(r,1),mc.world.sendMessage("§a§l§´"+t+" has been unbanned")}mc.world.setDynamicProperty("banList",JSON.stringify({banList:a}))})),mc.system.runInterval((()=>{for(const e of mc.world.getPlayers({excludeTags:["admin"]}))JSON.parse(mc.world.getDynamicProperty("banList")).banList.includes(e.name)&&e.triggerEvent("run:kick")}));